<!-- --------------------------------------------------------------------------------------------------------------- -->
{% extends 'app_users/base.html' %}
{% load static %}
{% load to_and %}
<!-- --------------------------------------------------------------------------------------------------------------- -->


<!-- ------------------------------------------------------------------------------------------------------- -->
{% block middle_body %}
    <!-- Top Bar Start ------------------------------------------------------------------------------------------------------- -->
    <div class="container-fluid w-100 shadow-sm bg-light" style="height: 55px;">
        <div class="d-flex flex-row justify-content-around flex-wrap pt-3">
            <!-- ------------------------------------------------------------------------------------------------------- -->
            <a href="{% url 'user_dashboard' %}">
                <img style="width: 33px; height: 33px;" src="{% static '/static_images/zos_logo.png' %}" alt="zOs" class="d-inline-block align-top img-fluid" />
            </a>
            <!-- ------------------------------------------------------------------------------------------------------- -->
            <div class="" style="font-family: Kalam;">
                <div class="dropdown">
                    <a class="dropdown-toggle text-success" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false" style="text-decoration: none; cursor: pointer">
                        {% if request.user.profile.avatar %}
                            <img class="w3-circle" src="{{ request.user.profile.avatar.url }}" alt="{{ request.user }}" style="width: 33px; height: 33px;">
                            {{ request.user }}
                        {% else %}
                            <img class="w3-circle" src="{% static '/static_images/anonymous_user.png' %}" alt="UserPhoto" style="width: 33px; height: 33px;">
                            {{ request.user }}
                        {% endif %}
                    </a>

                    <ul class="dropdown-menu dropdown-menu-end mt-3 rounded-1 text-success" aria-labelledby="dropdownMenuButton1">
                        <li>
                            <a class="dropdown-item text-success" href="{% url 'sign_me_out' %}">
                                <i class="bi bi-box-arrow-right"></i>
                                Logout
                            </a>
                        </li>

                        <li>
                            <a class="dropdown-item text-success" href="{% url 'change_my_photo' %}">
                                <i class="bi bi-camera"></i>
                                Change Photo
                            </a>
                        </li>

                        <li>
                            <a class="dropdown-item text-success" href="{% url 'change_my_password' %}">
                                <i class="bi bi-key"></i>
                                Change Password
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- Top Bar End ------------------------------------------------------------------------------------------------------- -->


    <!-- Middle Start ------------------------------------------------------------------------------------------------------- -->
    <div class="d-flex flex-row justify-content-center flex-wrap mt-3">
        {% for item in my_cameras %}
            <div class="card  m-2">
                <!-- ------------------------------------------------------------------------------------------------------- -->
                <div class="card-header">
                    <div class="d-flex flex-row justify-content-between flex-nowrap" style="">
                        <span><b>{{ item.dev_sl }} : {{ item.dev_name }}</b></span>

                        {% if item.active_status == 0 %}
                            <span>
                                <span class="spinner-grow spinner-grow-sm text-secondary" role="status"></span> <b class="text-secondary">Sleeping...</b>
                            </span>
                        {% elif item.active_status == 1 %}
                            <span>
                                <span class="spinner-grow spinner-grow-sm text-danger" role="status"></span> <b class="text-success">Live...</b>
                            </span>
                        {% elif item.active_status == 5 %}
                            <span>
                                <span><b class="text-warning">Disabled :(</b></span>
                            </span>
                        {% else %}
                            <span>
                                <span><b class="text-warning">Unknown ?</b></span>
                            </span>
                        {% endif %}
                    </div>
                </div>
                <!-- ------------------------------------------------------------------------------------------------------- -->
                <div class="d-flex flex-row justify-content-between flex-wrap p-2" style="">
                    <span class="" style=""><b class="text-info">Work Mode:</b> {{ item.dev_active_mode.capitalize }}</span>

                    {% if item.dev_active_mode == 'schedule' %}
                        <span class="" style=""><b class="text-info">Schedule:</b> {{ item.dev_active_hour_start }} ~ {{ item.dev_active_hour_end }}</span>
                    {% elif item.dev_active_mode == 'manual' %}
                        {% if item.active_status == 0 %}
                            <span>
                                <a class="btn btn-success btn-sm" href="{% url 'manually_activate_deactivate' item.dev_sl 1 %}" role="button">Activate Now <i class="bi bi-check-circle-fill"></i></a>
                            </span>
                        {% elif item.active_status == 1 %}
                            <span>
                                <a class="btn btn-secondary btn-sm" href="{% url 'manually_activate_deactivate' item.dev_sl 0 %}" role="button">Deactivate Now <i class="bi bi-check-circle-fill"></i></a>
                            </span>
                        {% endif %}
                    {% endif %}
                </div>
                <!-- ------------------------------------------------------------------------------------------------------- -->
                <img style="max-height: 600px;" src="{{ item.PhotoFromDevice_device_info_id.last.image_path.url }}" alt="Photo" class="d-inline-block align-top img-fluid p-2 pt-0 pb-0 mb-3" />
                <!-- ------------------------------------------------------------------------------------------------------- -->
                <p class="pt-0" style="text-align: start; margin-left: 25px;">Last Photo: {{ item.PhotoFromDevice_device_info_id.last.insert_date_time }}</p>
                <!-- ------------------------------------------------------------------------------------------------------- -->
                <div class="d-grid gap-2 m-4 mt-0 mb-3">
                    <!-- ------------------------------------------------------------------------------------------------------- -->
                    {% if item.busy_status %}
                        <!-- ------------------------------------------------------------------------------------------------------------------- -->
                        <div class="btn-group" role="group" aria-label="Basic mixed styles example">
                            <button disabled type="button" class="btn btn-success">
                                <select required class="form-select form-select" aria-label="Large select example">
                                    <option selected>Photo Size</option>
                                </select>
                            </button>

                            <button disabled type="button" class="btn btn-success">
                                <select required class="form-select form-select" aria-label="Large select example">
                                    <option selected>Flash Light</option>
                                </select>
                            </button>

                            <button disabled type="submit" class="btn btn-success"><i class="bi bi-camera-fill"></i> Take Photo</button>
                        </div>
                        <!-- ------------------------------------------------------------------------------------------------------------------- -->
{#                        <div class="btn-group" role="group" aria-label="Basic mixed styles example">#}
{#                            <button disabled type="submit" class="btn btn-warning w-50"><i class="bi bi-lightbulb-fill text-danger"></i> Light ON</button>#}
{#                            <button disabled type="submit" class="btn btn-secondary w-50"><i class="bi bi-lightbulb-fill text-muted"></i> Light OFF</button>#}
{#                        </div>#}

                        <div class="btn-group" role="group" aria-label="Basic mixed styles example">
                            <button type="submit" class="btn btn-primary" onclick="location.reload()"><i class="bi bi-arrow-clockwise"></i> Reload</button>
                        </div>
                    <!-- ------------------------------------------------------------------------------------------------------- -->
                    {% else %}
                        <!-- ------------------------------------------------------------------------------------------------------- -->
                        <form method="POST" action={% url 'capture_image' %}>
                            {% csrf_token %}

                            <div class="btn-group w-100" role="group" aria-label="Basic mixed styles example">
                                <button type="button" class="btn btn-success">
                                    <select name="resolution" required class="form-select form-select" aria-label="Large select example">
                                        <option value="x" selected>Photo Size</option>

                                        {% for res in img_resolution %}
                                            <option value="{{ res.cmd }}">{{ res.cmd_visual }}</option>
                                        {% endfor  %}
                                    </select>
                                </button>

                                <button type="button" class="btn btn-success">
                                    <select name="flash" required class="form-select form-select" aria-label="Large select example">
                                        <option value="x" selected>Flash Light</option>

                                        {% for fl in flash %}
                                            <option value="{{ fl.cmd }}">{{ fl.cmd_visual }}</option>
                                        {% endfor %}
                                    </select>
                                </button>

                                <button type="submit" class="btn btn-success"><i class="bi bi-camera-fill"></i> Take Photo</button>
                            </div>

                            <input type="hidden" id="dev_id_pk_id" name="dev_id_pk" value="{{ item.pk }}">
                        </form>
                        <!-- ------------------------------------------------------------------------------------------------------- -->
{#                        <form method="POST" action=''>#}
{#                            {% csrf_token %}#}
{##}
{#                            <div class="btn-group w-100" role="group" aria-label="Basic mixed styles example">#}
{#                                <button type="submit" formaction="{% url 'alarm_light_on' %}" name="alarm_light_on_off" value="1" class="btn btn-warning"><i class="bi bi-lightbulb-fill text-danger"></i> Light ON</button>#}
{#                                <button type="submit" formaction="{% url 'alarm_light_off' %}" name="alarm_light_on_off" value="0" class="btn btn-secondary"><i class="bi bi-lightbulb-fill text-muted"></i> Light OFF</button>#}
{#                            </div>#}
{##}
{#                            <input type="hidden" id="dev_id_pk_id" name="dev_id_pk" value="{{ item.pk }}">#}
{#                        </form>#}
                        <!-- ------------------------------------------------------------------------------------------------------- -->
                        <div class="btn-group" role="group" aria-label="Basic mixed styles example">
                            <button type="submit" class="btn btn-primary" onclick="location.reload()"><i class="bi bi-arrow-clockwise"></i> Reload</button>
                        </div>
                    {% endif %}
                    <!-- ------------------------------------------------------------------------------------------------------- -->
                </div>
                <!-- ------------------------------------------------------------------------------------------------------- -->
                <div class="card-footer">
                    <div class="d-flex flex-row justify-content-between flex-wrap p-2" style="">
                        <small class="text-primary" style=""> Last Connect: {{ item.DeviceHeartbeat_device_info_id.hb_time }}</small>
                        <span><a class="dropdown-item text-primary" href="{% url 'change_working_mode' item.dev_sl %}"><i class="bi bi-gear-wide-connected"></i> Settings</a></span>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
    <!-- Middle End ------------------------------------------------------------------------------------------------------- -->


    <!-- Bottom Bar Start --------------------------------------------------------------------------------------------------------------- -->

    <!-- Bottom Bar End ------------------------------------------------------------------------------------------------------- -->
{% endblock %}
<!-- --------------------------------------------------------------------------------------------------------------- -->
